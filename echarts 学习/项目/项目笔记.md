# KOA2 学习笔记

## KOA2的介绍

- 基于 Node.js 平台的Web服务器框架

- 由 Express 原班人马打造

  Express Koa , Koa2 都是 Web 服务器的框架,他们之间的差别和关系可以通过下面这个表格表示出来：

  | 框架名  | 作用     | 异步处理        |
  | ------- | -------- | --------------- |
  | Express | web 框架 | 回调函数        |
  | Koa     | web 框架 | Generator+yield |
  | Koa2    | web 框架 | async/await     |

- 环境依赖 Node v7.6.0 及以上

  由于 Koa2 它是支持 async 和 await，所以它对 Node 的版本是有要求的，它要求 Node 的版本至 少是在7.6级以上, 因为语法糖 async和await 是在 Node7.6 版本之后出现才支持。、

- 洋葱中间件

  如下图所示, 对于服务器而言，它其实就是来处理一个又一个的请求。Web 服务器接收由浏览器发过来的一个又一个请求之后，它形成一个又一个的响应返回给浏览器。

  而请求到达我们的服务器是需要经过程序处理的，程序处理完之后才会形成响应，返回给浏览器，我们服务器处理请求的这一块程序，在 Koa2 的世界当中就把它称之为中间件。

  ![image-20210930160316573](https://gitee.com/zyxbj/image-warehouse/raw/master/pics/202109301603620.png)

  这种中间件可能还不仅仅只有一个，可能会存在多个，比如上图所示, 它就存在三层中间件，这三层中间件在处理请求的过程以及它调用的顺序为:

  - 当一个请求到达服务器，最先处理这个请求的是第一层中间件
  - 第一层的中间件在处理这个请求之后，它会把这个请求给第二层的中间件
  - 第二层的中间件在处理这个请求之后，它会把这个请求给第三层的中间件
  - 第三层中间件内部并没有中间件了, 所以第三层中间件在处理完所有的代码之后，这个请求又会到了第二层的中间件，所以第二层中间件对这个请求处理了`两次`。
  - 第二层的中间件在处理完这个请求之后，又到了第一层的中间件, 所以第一层的中间件也对这个请求处理了`2次`。

  这个调用顺序就是洋葱模型, 中间件对请求的处理有一种先进后出的感觉，请求最先到达第一层中间件，而最后也是第一层中间件对请求再次处理了一下。

